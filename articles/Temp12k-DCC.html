<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Temp12k-DCC • compositeR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Temp12k-DCC">
<meta property="og:description" content="compositeR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">compositeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Temp12k-DCC.html">Temp12k-DCC</a>
    </li>
    <li>
      <a href="../articles/Temp12k_IceCore.html">Temp12k_IceCore</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Temp12k-DCC</h1>
            
      
      
      <div class="hidden name"><code>Temp12k-DCC.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">compositeR</span><span class="op">)</span><span class="co">#devtools::install_github("nickmckay/compositeR")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nickmckay/GeoChronR" class="external-link">geoChronR</a></span><span class="op">)</span> <span class="co">#devtools::install_github("nickmckay/geoChronR")</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Welcome to geoChronR version 1.1.12!</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">lipdR</span><span class="op">)</span>     <span class="co">#devtools::install_github("nickmckay/lipd-utilities",subdir = "R")</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'lipdR'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:geoChronR':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     createTSid, pullTsVariable</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'magrittr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:purrr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     set_names</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/foreach" class="external-link">foreach</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'foreach'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:purrr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     accumulate, when</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RevolutionAnalytics/doparallel" class="external-link">doParallel</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: iterators</span></span>
<span><span class="co">#&gt; Loading required package: parallel</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Data to use</span></span>
<span><span class="va">Temp12k</span> <span class="op">&lt;-</span> <span class="va">Temp12k</span></span>
<span><span class="va">sg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geoChronR/man/pullTsVariable.html" class="external-link">pullTsVariable</a></span><span class="op">(</span><span class="va">Temp12k</span>, <span class="st">"climateInterpretation1_seasonalityGeneral"</span><span class="op">)</span></span>
<span><span class="va">ic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geoChronR/man/pullTsVariable.html" class="external-link">pullTsVariable</a></span><span class="op">(</span><span class="va">Temp12k</span>, <span class="st">"paleoData_inCompilation"</span><span class="op">)</span></span>
<span><span class="va">u</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/geoChronR/man/pullTsVariable.html" class="external-link">pullTsVariable</a></span><span class="op">(</span><span class="va">Temp12k</span>, <span class="st">"paleoData_units"</span><span class="op">)</span></span>
<span><span class="co">#TODO this filter isn't quite right. Why aren't seasons standardized (length of fTS should be 782 not 827)</span></span>
<span><span class="va">tu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">ic</span><span class="op">)</span> <span class="op">==</span> <span class="st">"temp12k"</span> <span class="op">&amp;</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">sg</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"summer+"</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">sg</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"winter+"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span> <span class="op">==</span> <span class="st">"degc"</span><span class="op">)</span></span>
<span><span class="va">fTS</span> <span class="op">&lt;-</span> <span class="va">Temp12k</span><span class="op">[</span><span class="va">tu</span><span class="op">]</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fTS</span><span class="op">)</span><span class="op">!=</span><span class="fl">782</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'WARNING: unexpected number ('</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fTS</span><span class="op">)</span>,<span class="st">') of proxy records filtered. The expected number should be 782 for DCC'</span><span class="op">)</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "WARNING: unexpected number (767) of proxy records filtered. The expected number should be 782 for DCC"</span></span>
<span><span class="va">fTS</span> <span class="op">&lt;-</span> <span class="va">fTS</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/geoChronR/man/pullTsVariable.html" class="external-link">pullTsVariable</a></span><span class="op">(</span><span class="va">fTS</span>,<span class="st">'age'</span><span class="op">)</span>,<span class="va">mean</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fTS</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> </span>
<span>  <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">fTS</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">paleoData_temperature12kUncertainty</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">unc</span><span class="op">)</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">{</span><span class="va">unc</span><span class="op">&lt;-</span><span class="cn">NA</span><span class="op">}</span></span>
<span>  <span class="va">proxy</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">fTS</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">paleoData_proxy</span><span class="op">)</span></span>
<span>  <span class="va">archive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">fTS</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">archiveType</span><span class="op">)</span></span>
<span>  <span class="va">season</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">fTS</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">climateInterpretation1_seasonalityGeneral</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">unc</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'marine'</span>,<span class="va">archive</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">proxy</span> <span class="op">==</span> <span class="st">"alkenone"</span><span class="op">)</span><span class="op">{</span>           <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">1.7</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'marine'</span>,<span class="va">archive</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">proxy</span> <span class="op">==</span> <span class="st">"d18o"</span><span class="op">)</span><span class="op">{</span><span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">2.1</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'marine'</span>,<span class="va">archive</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">proxy</span> <span class="op">==</span> <span class="st">"mg/ca"</span><span class="op">)</span><span class="op">{</span> <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">1.9</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'marine'</span>,<span class="va">archive</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">proxy</span> <span class="op">==</span> <span class="st">"foraminifera"</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="kw">if</span>       <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'summer'</span>,<span class="va">season</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">1.3</span></span>
<span>      <span class="op">}</span><span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'winter'</span>,<span class="va">season</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">1.4</span></span>
<span>      <span class="op">}</span><span class="kw">else</span><span class="op">{</span>                             <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">1.3</span><span class="op">}</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'marine'</span>,<span class="va">archive</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">proxy</span> <span class="op">==</span> <span class="st">"dinocyst"</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="kw">if</span>       <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'summer'</span>,<span class="va">season</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">1.7</span></span>
<span>      <span class="op">}</span><span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'winter'</span>,<span class="va">season</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">1.2</span></span>
<span>      <span class="op">}</span><span class="kw">else</span><span class="op">{</span>                             <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">1.2</span><span class="op">}</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">proxy</span> <span class="op">==</span> <span class="st">'tex86'</span><span class="op">)</span><span class="op">{</span>        <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">2.3</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">proxy</span> <span class="op">==</span> <span class="st">'diatom'</span><span class="op">)</span><span class="op">{</span>       <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">1.1</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">proxy</span> <span class="op">==</span> <span class="st">'radiolaria'</span><span class="op">)</span><span class="op">{</span>   <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">1.2</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">proxy</span> <span class="op">==</span> <span class="st">'pollen'</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="kw">if</span>       <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'summer'</span>,<span class="va">season</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">2.0</span></span>
<span>      <span class="op">}</span><span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'winter'</span>,<span class="va">season</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">3.0</span></span>
<span>      <span class="op">}</span><span class="kw">else</span><span class="op">{</span>                             <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">2.1</span><span class="op">}</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">proxy</span> <span class="op">==</span> <span class="st">'gdgt'</span><span class="op">)</span><span class="op">{</span>         <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">2.9</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">proxy</span> <span class="op">==</span> <span class="st">'chironomid'</span><span class="op">)</span><span class="op">{</span>   <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">1.4</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span><span class="op">{</span>                              <span class="va">unc</span> <span class="op">&lt;-</span> <span class="fl">2.7</span> <span class="co">#default</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">fTS</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">paleoData_temperature12kUncertainty</span> <span class="op">&lt;-</span> <span class="va">unc</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#bin vectors for the composite output</span></span>
<span><span class="va">binvec</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, to <span class="op">=</span> <span class="fl">12050</span>, by <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">binAges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">binvec</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,<span class="va">binvec</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">binvec</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Text from Kaufman et al. (2020):</p>
<p>“This procedure is similar to the SCC except, instead of using a
single time window to align the records, this method applies a dynamic
record-aligning procedure and it uses different approaches to
characterizing the uncertainties.</p>
<p>The <strong>mean temperatures of each record were adjusted
iteratively to optimally minimize the mean offset between each
record</strong> and all other records within each latitudinal band over
the past 12,000 years. This allowed time series with minimal or no
overlap to be included in the composite, so all of the calibrated
records in the database were used.</p>
<p>No spatial gridding was applied, but the records were
<strong>averaged within latitudinal bands</strong>.</p>
<p>For this method, <strong>errors in the proxy temperatures were either
drawn from the posterior outputs of Bayesian temperature calibrations,
where available in the database (n = 149, ref. 5), or simulated from the
uncertainties summarized for each proxy type</strong>. For the
simulation, the uncertainties were assumed to be auto-correlated, with
an <strong>AR1 coefficient of 0.71</strong>, such that 50% of the
variance in the uncertainties is auto-correlated. This model reflects
the contribution of correlated bias, as well as uncorrelated
uncertainties. <strong>Age uncertainties were simulated using the Banded
Age Model (BAM)27, with a Poisson model and symmetric 5% over- and
under-counting probabilities</strong>. Although BAM is designed for
layer-counted age modelling, it produces reasonable first-order
estimates of age uncertainty, and only requires the original ages as
input. To demonstrate this, we compared the BAM-based ensembles produced
here to 108 proxy datasets with age models produced by Bacon28. The root
mean square error (RMSE) of the ensemble members was calculated relative
to the median of each age ensemble over the past 12,000 years. The Bacon
models had a median (mean) RMSE of 198 (216) years, whereas the BAM
models produced here had a median (mean) RMSE of 251 (260) years. We
find that BAM produces age ensembles with uncertainty ranges that are
comparable to, but slightly larger than Bacon for these datasets.
Although BAM does not accurately represent the full uncertainty
structure, it ultimately produces similar, and slightly more
conservative, results. Before compositing, DCC randomly selected
separate temperature and age ensemble members, thereby effectively
propagating these uncertainties through the subsequent compositing
steps.”</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Defaults: duration = 3000, searchRange = c(0,7000), gaussianizeInput = FALSE, normalizeVariance = FALSE, </span></span>
<span><span class="co">#          stanFun = standardizeMeanIteratively</span></span>
<span><span class="co">#          binFun = sampleEnsembleThenBinTs</span></span>
<span><span class="va">fTS_marine</span> <span class="op">&lt;-</span> <span class="va">fTS</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/geoChronR/man/pullTsVariable.html" class="external-link">pullTsVariable</a></span><span class="op">(</span><span class="va">fTS</span>,<span class="st">'archiveType'</span><span class="op">)</span><span class="op">==</span><span class="st">'MarineSediment'</span><span class="op">]</span></span>
<span><span class="va">nens</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">ensOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nens</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">%dopar%</a></span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ts</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">groupVar</span> <span class="op">&lt;-</span> <span class="st">'paleoData_proxyGeneral'</span></span>
<span><span class="va">ensOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">foreach</a></span><span class="op">(</span>i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">nens</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/foreach/man/foreach.html" class="external-link">%dopar%</a></span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span>mode<span class="op">=</span><span class="st">'list'</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">group</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/geoChronR/man/pullTsVariable.html" class="external-link">pullTsVariable</a></span><span class="op">(</span><span class="va">fTS_marine</span>,<span class="va">groupVar</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">fi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/geoChronR/man/pullTsVariable.html" class="external-link">pullTsVariable</a></span><span class="op">(</span><span class="va">fTS_marine</span>,<span class="va">groupVar</span><span class="op">)</span><span class="op">==</span><span class="va">group</span><span class="op">)</span></span>
<span>    <span class="va">out</span><span class="op">[[</span><span class="va">group</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/compositeEnsembles.html">compositeEnsembles</a></span><span class="op">(</span><span class="va">fTS_marine</span><span class="op">[</span><span class="va">fi</span><span class="op">]</span>, <span class="va">binvec</span>, duration <span class="op">=</span> <span class="fl">3000</span>, searchRange <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">7000</span><span class="op">)</span>, stanFun <span class="op">=</span> <span class="va">standardizeMeanIteratively</span>, uncVar <span class="op">=</span> <span class="st">'paleoData_temperature12kUncertainty'</span><span class="op">)</span></span>
<span>    <span class="co">#out[[group]] &lt;-  compositeDCC(fTS_marine[fi], binvec, uncVar = 'paleoData_temperature12kUncertainty')</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reformatCompositeOut</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ensOut</span>,<span class="va">X</span>,<span class="va">groupVar</span>,<span class="va">weights</span><span class="op">=</span><span class="cn">NA</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">w</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">groupVar</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span><span class="va">w</span><span class="op">&lt;-</span><span class="va">weights</span><span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">#</span></span>
<span>  <span class="va">reformatComposite</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">'list'</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">group</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ensOut</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">compMat</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ensOut</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sublist</span><span class="op">)</span> <span class="va">sublist</span><span class="op">[[</span><span class="va">group</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="va">extract2</span>, <span class="st">'composite'</span><span class="op">)</span></span>
<span>    <span class="va">countMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ensOut</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sublist</span><span class="op">)</span> <span class="va">sublist</span><span class="op">[[</span><span class="va">group</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="va">extract2</span>, <span class="st">'timeCount'</span><span class="op">)</span></span>
<span>    <span class="va">countMat</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">countMat</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="va">reformatComposite</span><span class="op">[[</span><span class="va">group</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>age<span class="op">=</span><span class="va">X</span>,count<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">countMat</span>,<span class="fl">1</span>,<span class="va">median</span><span class="op">)</span>,<span class="va">compMat</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">reformatComposite</span><span class="op">[[</span><span class="st">'average'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">reformatComposite</span><span class="op">[[</span><span class="va">group</span><span class="op">]</span><span class="op">]</span><span class="op">*</span><span class="cn">NA</span></span>
<span>  <span class="va">reformatComposite</span><span class="op">[[</span><span class="st">'average'</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">age</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">reformatComposite</span>, <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="va">df</span><span class="op">$</span><span class="va">age</span><span class="op">)</span>,<span class="fl">1</span>,<span class="va">mean</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="va">reformatComposite</span><span class="op">[[</span><span class="st">'average'</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">reformatComposite</span>, <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="va">df</span><span class="op">$</span><span class="va">count</span><span class="op">)</span>,<span class="fl">1</span>,<span class="va">sum</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">c</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">reformatComposite</span><span class="op">[[</span><span class="st">'average'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">reformatComposite</span><span class="op">[[</span><span class="st">'average'</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">c</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">reformatComposite</span>, <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="va">df</span><span class="op">[[</span><span class="va">c</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,<span class="fl">1</span>,<span class="va">mean</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">reformatComposite</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="va">compDf</span> <span class="op">&lt;-</span> <span class="fu">reformatCompositeOut</span><span class="op">(</span><span class="va">ensOut</span>,<span class="va">binAges</span>,<span class="va">groupVar</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">q</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">compDf</span><span class="op">$</span><span class="va">average</span><span class="op">$</span><span class="va">age</span>,</span>
<span>                  ymin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">compDf</span><span class="op">$</span><span class="va">average</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">quantile</span>,<span class="va">q</span><span class="op">)</span>,</span>
<span>                  ymax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">compDf</span><span class="op">$</span><span class="va">average</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">quantile</span>,<span class="fl">1</span><span class="op">-</span><span class="va">q</span><span class="op">)</span><span class="op">)</span>,</span>
<span>              alpha<span class="op">=</span><span class="fl">0.3</span>,color<span class="op">=</span><span class="st">'grey'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">compDf</span><span class="op">$</span><span class="va">average</span><span class="op">$</span><span class="va">age</span>,y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">compDf</span><span class="op">$</span><span class="va">average</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">median</span><span class="op">)</span><span class="op">)</span>,color<span class="op">=</span><span class="st">'black'</span>,size<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_reverse</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">binvec</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">'age'</span>,y<span class="op">=</span><span class="st">'composite anomaly'</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plt</span><span class="op">)</span></span></code></pre></div>
<p><img src="Temp12k-DCC_files/figure-html/unnamed-chunk-5-1.png" width="624"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#dim(x_lists)</span></span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by McKay Nick, Hancock Christopher.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
